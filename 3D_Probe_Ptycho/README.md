# 3D Probe Ptychography

Here are simulations investigating a new ptychography method, combining 3D back projection ptychography (3DBPP, V. Chamard et al.) with an objective lens. The idea is that the combination of a small beam and a slit in the image plane of the lens forms a probe limited in size in all 3 spatial dimensions, thus removing any restrictions on sample size.

The primary forward simulations and reconstructions are in the sub-folders, each containing the following files:  
- Generate_Phantom.m (and Generate_Phantom_2.m): Generate the shape and phase of the phantom object.
  - In version 2 the phase of the phantom is a more realistic physical model.
- Generate_Exit_Fields.m: Calculate the 2D complex wavefront at the sample location for each probe position.
- Forward_Propagation.m: Simulate the detector intensity (including shot noise) for each probe position.
  - The partial coherence simulations use a finite energy spread of the incoming beam, and the forward propagation is significantly slower due to increased number of simulations.
- Reconstruction.m: Use the new reconstruction algorithm to reconstruct the object from the probe positions (beam and slit) and the detector intensity.

Data processing scripts:
- Compare_Reconstructions.m: Show side-by-side comparisons of 4 reconstructions.
- Extract_Line_Profiles.m and Fit_Line_Profiles.m: Extract lines through the faces and fit an erf to estimate the resolution.
- Extract_Plotting_Data(Partial_Coherence).m: Normalize amplitude and align phase of chose reconstructions, to be used to plotting.
- Plots_Reconstructions(Partial_Coherence).m: Plot the normalized reconstructions.
- Plots_Reconstructions_Phase_Difference.m: Plot phase difference maps between the ground truth and reconstructions.
- Plotting_Data_MTF.m: Fit and plot the mutual transfer function (MTF) in reciprocal space of reconstructions.
- Plotting_Data_Phase_Aberrations.m: We saw some phase artifacts in the reconstructions, and in the first generation reconstructions (with phantom generated by Generate_Phantom.m) there was an additional quadratic phase in the reconstructions.
- Projection_Probe_Only.m: Make a reconstruction based only on projection between 3D and 2D (one part of the 3DBPP algorithm), which should provide a lower bound on the reconstruction quality.
- Run_All.m: Run all (or some) of the forward propagations and reconstructions in the sub-folders.

Additional files:
- arrow.m: Function for drawing arrows on plots, used in some of the plotting scripts above.
- Word and PowerPoint files: Results and background information.

